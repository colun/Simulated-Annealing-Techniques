
# 探索空間が単峰に近い

峰というのは大きい局所とします。
探索空間の峰が1つなら単峰、複数なら多峰です。

![modal](/images/modal.png)

局所がどのぐらい大きいと峰なのかを説明します。
まず、焼きなましは現在の温度と釣りあうスコア付近をランダムウォークします。

![score-histogram-per-temperature](/images/score-histogram-per-temperature.png)

そのため上図のように、現在の温度のランダムウォークでは現実的に到達できない状態があるぐらい大きい局所が峰です。
ようするに、**焼きなましは大きい局所を突破できず**（俗にいう局所解にはまる）、そのような局所を峰としました。

![higher-temperature-modal](/images/higher-temperature-modal.png)

高温ならまだ単峰です。

![medium-temperature-modal](/images/medium-temperature-modal.png)

温度が下がると峰がわかれて多峰になります。

![lower-temperature-modal](/images/lower-temperature-modal.png)

温度が下がるほど爆発的に峰が増えていきます。

最後に単峰に近いというのは、できる限り低温でも単峰であること、かつさらに低温でも峰数ができる限り少ないこと、かつ1番大きい峰が他よりもできる限り大きいことです。
**単峰に近いほど性能が良くなります。**
なぜなら、前述のように峰から峰へは移動できないので峰数は少ない方が良いです。

![larger-modal-is-better](/images/larger-modal-is-better.png)

また、スコアがすごく良い状態群は1番大きい峰に多く含まれる傾向があります。
そして、峰が大きいほど間口も大きく、すべての峰の間口に占める1番大きい峰の間口の割合が大きいほど、ランダムウォークしたときに1番大きい峰に残留する確率が大きくなります。
これが1番大きい峰が大きいほど良い理由です。

探索空間を単峰に十分近くするのは困難です。
逆説的ですが、十分に近いならば最適解が求まるので、最適解が求まらない難しい問題では十分に近くはなりません。
したがって、単峰にできるだけ近づけたいということになります。

では単峰に近づく余地の調べ方を説明します。

任意に1つの状態を思い浮かべます。
その状態から最速（から数倍以内程度）でスコア変化量が求まるすべての状態のうち、**スコア変化量が小さい状態を近傍で網羅する**ことを意識します。
（近傍の近さの定義は色々考えられますが、ここでは計算時間が短いことを近いとみなしています。
少なくとも、**人の感覚的な近さと焼きなましやビームサーチを解釈する上で都合のよい近さは一致しない**ことに留意してください。）
網羅とは書きましたが網羅されていないと必ずしも単峰から遠いわけではないです。
じゃあなんで網羅なのかというと、網羅されていれば一定の近さが保障されることと、そもそも単峰に近い遠いの判断はめちゃくちゃ難しいので、網羅の肯否で代用せざるをえないからです。
網羅の肯否ですら私にとっても十分難しいのであくまでがんばって意識をするです。
**あと、ゴミ近傍（スコア変化量が大きい近傍）が多分に混ざってでも網羅を優先させてください。**
なぜなら、多峰による断絶が致命的なのに対して、ゴミが混じるのは収束速度が遅くなるだけだからです。
ここまでを踏まえて、網羅の漏れが見つかればそれを近傍に足すだけでもスコアが良くなるはずです。

もし、上述を試してもなお多峰感が強ければより遅くとも大きい近傍を検討します。
